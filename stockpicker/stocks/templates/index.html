<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>選股網</title>
    <style>
        /* 全域性設置 */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            display: flex;
            flex-wrap: wrap; /* 允許換行 */
            margin: 0;
            padding: 0;
        }

        #left {
            flex: 1 1 70%; /* 允許調整，初始為70%寬度 */
            padding: 10px;
            box-sizing: border-box;
            height: 100vh; /* 設置與視窗高度相同 */
        }

        #right {
            flex: 1 1 30%; /* 允許調整，初始為30%寬度 */
            padding: 10px;
            background-color: #f8f8f8;
            border-left: 1px solid #ddd;
            height: 100vh;  /* 設置固定高度 */
            overflow-y: auto;  /* 啟用垂直滾動條 */
            box-sizing: border-box;
        }
        
        /* 隱藏滾動條 */
        #right::-webkit-scrollbar {
            display: none; /* 用於 Chrome、Safari 和 Edge */
        }

        #right {
            -ms-overflow-style: none;  /* 用於 Internet Explorer 和 Edge */
            scrollbar-width: none;  /* 用於 Firefox */
        }

        #tradingview_chart {
            width: 100%;  
            height: calc(100vh - 50px);  
        }

        /* h1 {
            text-align: center;
            margin-bottom: 20px;
        } */

        #stock-results {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
            background-color: #f9f9f9;
        }

        #stock-results th, #stock-results td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }

        #stock-results th {
            background-color: #4CAF50;
            color: white;
        }

        #stock-results tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        #stock-results tr {
            cursor: pointer;
        }

        #stock-results tr:hover {
            background-color: #e2e2e2;
        }
    </style>
</head>
<body>
    <div id="left">
        <!-- <h1>TradingView 高級圖表</h1> -->
        <div id="tradingview_chart"></div>
    </div>

    <div id="right">
        <h2>台股報價</h2>
        <button id="select-button" onclick="getSelectedStocks()">開始選股</button>
        <table id="stock-results">
            <thead>
                <tr>
                    <th>股票代碼</th>
                    <th>股票名稱</th>
                    <th>當前價</th>
                </tr>
            </thead>
            <tbody>
                <!-- 選股結果將動態插入到這裡 -->
            </tbody>
        </table>
    </div>

    <!-- 引入 TradingView 的 JavaScript 庫 -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        // 初始化 TradingView 圖表
        function loadChart(ticker, name) {
            new TradingView.widget({
                "width": '100%',
                "height": '100%',
                "symbol": ticker,  // 使用正確的格式顯示股票代碼，如 TWSE:1453
                "interval": "D",
                "timezone": "Etc/UTC",
                "theme": "light",
                "style": "1",
                "locale": "zh_TW",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "allow_symbol_change": true,
                "container_id": "tradingview_chart"
            });
            // document.querySelector('h1').textContent = `${ticker} ${name}`;  // 更新標題顯示股票代碼與名稱
        }

        // 從後端選股並顯示結果
        function getSelectedStocks() {
            const selectButton = document.getElementById('select-button');
            selectButton.disabled = true;  // 禁用按鈕
            selectButton.textContent = '選股中...';  // 修改按鈕文本

            fetch('/select-stock/')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.querySelector('#stock-results tbody');
                    tableBody.innerHTML = ''; 

                    if (data.selected_stocks.length > 0) {
                        data.selected_stocks.forEach(stock => {
                            const row = document.createElement('tr');
                            row.onclick = function() {
                                loadChart(stock.code, stock.name);  // 點擊時加載該股票的圖表
                            }
                            row.innerHTML = `
                                <td>${stock.code}</td>
                                <td>${stock.name}</td>
                                <td>${stock.current_price}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    } else {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td colspan="3">沒有選中的股票</td>`;
                        tableBody.appendChild(row);
                    }

                    selectButton.disabled = false;  // 啟用按鈕
                    selectButton.textContent = '開始選股';  // 恢復按鈕文本
                })
                .catch(error => {
                    console.error('Error fetching selected stocks:', error);
                    selectButton.disabled = false;  // 發生錯誤時啟用按鈕
                    selectButton.textContent = '開始選股';  // 恢復按鈕文本
                });
        }
    </script>
</body>
</html>
